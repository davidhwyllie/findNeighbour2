Method
------
The results of EW2 were compared with those from the production EW1 server present in GEL.

This contained at the point of testing 21,849 *M. tuberculosis* samples.

15986 were loaded into EW2 and, for each of these (all of which are in EW1)  
The script doing this comparison is ../ew1cmp/ew1vsew2.py  

The algorithm:  
* Determined guids in EW1  
* Determines guids in EW2  
* Ensures the latter is a subset of the former; [passed]  
* for each guid in EW2:    
	checks whether the matches obtained by both systems are the same;  
	if they are not, reports the difference;  
	if there is a discrepancy, performs an 'exact' check. This involves going to the original fasta files, masking additional genes (rpoB, Rv2082, rrl, rrs), and performing a character-by-character pairwise comparison.
	reports whether the 'exact' check matches the EW2 result.  

  
Results:
-------
1 EW1 and EW2 results (using the EW2 configuration used for testing) are very similar, but are not the same.  
2 As currently configured, 20% of guids examined contain at least one difference.  
3 On average, EW2 gives distances 0.2 SNP less than EW1.  
4 It has been proven that this is due to differential masking by EW2 vs EW1.
- EW2 uses a 'masking file' to identify bases at which variation is not to be called
- This masking is applied to all sequences, irrespective of what is written (N or otherwise) in the relevant bases
- This 'masking file' has been generated from all the 'always N' positions in the 15,986 test set plus all the positions in the four additional genes masked by fastMasker.
- EW1 relies on the presence of Ns in the sequence, either generated by the pipeline or added by EW1 using a module called 'fastaMasker' used to mask four additional genes
- An 'exact check' between fastaMasker-masked sequences compared pairwise, and the EW2 output, is always congruent.

5 Therefore, the differences between EW1 and EW2 are due to one or more of the following:  
- The masking in the sequences passed to EW1 being inconsistent, perhaps across pipeline versions
- The masked bases in EW1 being different from those deduced by step 4, bullet 3.  If the exact masking used by the TB pipeline can be supplied, we can test this.
- A software error in EW1.



  

  